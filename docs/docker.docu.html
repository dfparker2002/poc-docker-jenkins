<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>docker.docu</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="docker.docu"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-02-19 18:26:26 CET"/>
<meta name="author" content="Michael Klöckner"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">docker.docu</h1>



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Overview</a>
<ul>
<li><a href="#sec-1-1">1.1 Purpose</a></li>
<li><a href="#sec-1-2">1.2 Author</a></li>
</ul>
</li>
<li><a href="#sec-2">2 Installing docker</a>
<ul>
<li><a href="#sec-2-1">2.1 Kernel options</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1 By Hand</a></li>
<li><a href="#sec-2-1-2">2.1.2 Installation Script</a></li>
<li><a href="#sec-2-1-3">2.1.3 AWS</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2 Play with docker</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1 Check your Docker installation.</a></li>
<li><a href="#sec-2-2-2">2.2.2 Download a pre-built image</a></li>
<li><a href="#sec-2-2-3">2.2.3 Run an interactive shell</a></li>
<li><a href="#sec-2-2-4">2.2.4 Bind to a port</a></li>
<li><a href="#sec-2-2-5">2.2.5 Starting a long run</a></li>
<li><a href="#sec-2-2-6">2.2.6 Bind a service on a TCP port</a></li>
<li><a href="#sec-2-2-7">2.2.7 Committing (saving) a container state</a></li>
<li><a href="#sec-2-2-8">2.2.8 Committing a Container to a Named Image</a></li>
<li><a href="#sec-2-2-9">2.2.9 Pushing an image to its repository</a></li>
<li><a href="#sec-2-2-10">2.2.10 Private Repositories</a></li>
<li><a href="#sec-2-2-11">2.2.11 Export a container</a></li>
<li><a href="#sec-2-2-12">2.2.12 Import a container</a></li>
<li><a href="#sec-2-2-13">2.2.13 Authentication file</a></li>
</ul>
</li>
<li><a href="#sec-2-3">2.3 Build your own base image</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1 Download the script</a></li>
<li><a href="#sec-2-3-2">2.3.2 Build the base image</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 Installing a <i>Scala/Java</i> WebApp</a>
<ul>
<li><a href="#sec-3-1">3.1 Installing <i>Java</i> and <i>Lift</i></a>
<ul>
<li><a href="#sec-3-1-1">3.1.1 The necessary debian packages</a></li>
<li><a href="#sec-3-1-2">3.1.2 check if we need apache packages?</a></li>
<li><a href="#sec-3-1-3">3.1.3 Scala WebApp</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2 Installing <i>tomcat7</i></a></li>
<li><a href="#sec-3-3">3.3 Deploying the WebApp to <i>tomcat7</i></a></li>
</ul>
</li>
<li><a href="#sec-4">4 Installing Jenkinsx</a></li>
<li><a href="#sec-5">5 Configure Jenkins to publish a container into the registry</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Purpose</h3>
<div class="outline-text-3" id="text-1-1">

<p>This paper documents the Proof of Concept Project as described in the Scope of Work written by Elemica:
Enable a Jenkins build server to publish release artifacts as Docker images to a Docker registry. Start
service on a new EC2 node by fetching the artifact from the registry.
</p></div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Author</h3>
<div class="outline-text-3" id="text-1-2">

<ul>
<li>Author: Michael Klöckner, Weberstr. 39, 60318 Frankfurt am Main, 
</li>
<li>Email:mkl@im7.de
</li>
<li>Phone: +49 69 9866 1103
</li>
</ul>

</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Installing docker</h2>
<div class="outline-text-2" id="text-2">

<p>This installation guide is take from the <a href="http://docs.docer.io/en/latest/">Docker documentation</a>.
</p>
</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Kernel options</h3>
<div class="outline-text-3" id="text-2-1">

<p>Docker needs a 64-Bit Linux distribution, a recent kernel &gt; 3.8 and LXC
installed. Either you use a system with the appropriate kernel installed, or
you update the kernel by hand as described in kernel compilation. The ker-
nel needs to have compiled all options concerning virtual NICs, especially
BRIDGED NICs, all NAT options and all net  ( NF ) options. Download
the kernel source, untar it, change into the directory and configure it prop-
erly. To compile the kernel as a debian package named <b>fora-kernel-3.13.3</b>
to be installed later together with it's header follow these instructions:
</p>


<pre class="src src-sh">make-kpkg clean
make-kpkg --append-to-version <span style="color: #8b2252;">"-flora-kernel-3.13.3"</span> --revision <span style="color: #8b2252;">"1"</span> <span style="color: #8b2252;">\</span>
--initrd kernel_image kernel_headers
</pre>

<p>
The package is to be found one directory upwards and can be installed using
</p>


<pre class="src src-sh">dpkg -i ../linux-headers-3.13.3-flora-kernel-3.13.3_1.2_amd64.deb <span style="color: #8b2252;">\</span>
../linux-image-3.13.3-flora-kernel-3.13.3_1.2_amd64.deb/.
</pre>


</div>

<div id="outline-container-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> By Hand</h4>
<div class="outline-text-4" id="text-2-1-1">

<p>First add the Docker repository key to your local keychain.
</p>


<pre class="src src-sh">sudo apt-key adv --keyserver keyserver.ubuntu.com <span style="color: #8b2252;">\</span>
--recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9
</pre>

<p>
Add the Docker repository to your apt sources list, update and install
the lxc-docker package.
</p>


<pre class="src src-sh">sudo sh -c <span style="color: #8b2252;">"echo deb http://get.docker.io/ubuntu docker main\</span>
<span style="color: #8b2252;">&gt; /etc/apt/sources.list.d/docker.list"</span>
sudo apt-get update
sudo apt-get install lxc-docker
</pre>

<p>
Now verify that the installation has worked by downloading the ubuntu
image and launching a container. <code>sudo docker run -i -t ubuntu /bin/bash</code>.
Type exit to exit.
</p></div>

</div>

<div id="outline-container-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> Installation Script</h4>
<div class="outline-text-4" id="text-2-1-2">

<p>Docker.io provides an installation script to be called: <code>curl -s https://get.docker.io/ubuntu/ | sudo sh</code>
Now verify that the installation has worked by downloading the ubuntu
image and launching a container. <code>sudo docker run -i -t ubuntu /bin/bash</code>
Type exit to exit.
</p></div>

</div>

<div id="outline-container-2-1-3" class="outline-4">
<h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span> AWS</h4>
<div class="outline-text-4" id="text-2-1-3">

<p>Docker.io provides an installation guide for Amazon Web Services EC2.
</p><ul>
<li>Choose an image: 
<ul>
<li>Launch the Create Instance Wizard menu on your AWS Console.
</li>
<li>Click the Select button for a 64Bit Ubuntu image. For example: Ubuntu Server 12.04.3 LTS. 
</li>
<li>For testing you can use the default (possibly free) t1.micro instance (more info on pricing). 
</li>
<li>Click the Next: Configure Instance Details button at the bottom right.
</li>
</ul>

</li>
<li>Tell CloudInit to install Docker:
<ul>
<li>When you're on the Configure Instance Details step, expand the Advanced Details section.
</li>
<li>Under User data, select As text
</li>
<li>Enter =#include <a href="https://get.docker.io">https://get.docker.io</a> = into the instance User Data. CloudInit is part of the Ubuntu image you chose; it will bootstrap Docker by running the shell script located at this URL.
</li>
</ul>

</li>
<li>After a few more standard choices where defaults are probably ok, your AWS Ubuntu instance with Docker should be running!
</li>
</ul>

<p>If this is your first AWS instance, you may need to set up your Security Group to allow SSH. By default all incoming ports to your new instance will be blocked by the AWS Security Group, so you might just get
timeouts when you try to connect. Installing with get.docker.io (as above) will create a service named lxc-
docker. It will also set up a docker group and you may want to add the ubuntu user to it so that you don't have to use sudo for every Docker command.
</p></div>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Play with docker</h3>
<div class="outline-text-3" id="text-2-2">


</div>

<div id="outline-container-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Check your Docker installation.</h4>
<div class="outline-text-4" id="text-2-2-1">




<pre class="src src-bash"># Check that you have a working install
docker info
</pre>

</div>

</div>

<div id="outline-container-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Download a pre-built image</h4>
<div class="outline-text-4" id="text-2-2-2">




<pre class="src src-bash"># Download an ubuntu image
sudo docker pull ubuntu
</pre>

</div>

</div>

<div id="outline-container-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> Run an interactive shell</h4>
<div class="outline-text-4" id="text-2-2-3">




<pre class="src src-bash"># Run an interactive shell in the ubuntu image,
# allocate a tty, attach stdin and stdout
# To detach the tty without exiting the shell,
# use the escape sequence Ctrl-p + Ctrl-q
sudo docker run -i -t ubuntu /bin/bash
</pre>

</div>

</div>

<div id="outline-container-2-2-4" class="outline-4">
<h4 id="sec-2-2-4"><span class="section-number-4">2.2.4</span> Bind to a port</h4>
<div class="outline-text-4" id="text-2-2-4">

<p>The Docker client can use -H to connect to a custom port.
-H accepts host and port assignment in the following format: 
</p><ul>
<li>tcp://[host][:port]  =
</li>
<li>unix://path =
</li>
<li>host[:port] or :port =
</li>
</ul>





<pre class="src src-bash"># Run docker in daemon mode
sudo &lt;path to&gt;/docker -H 0.0.0.0:5555 -d &amp;
# Download an ubuntu image
sudo docker -H :5555 pull ubuntu
</pre>

</div>

</div>

<div id="outline-container-2-2-5" class="outline-4">
<h4 id="sec-2-2-5"><span class="section-number-4">2.2.5</span> Starting a long run</h4>
<div class="outline-text-4" id="text-2-2-5">




<pre class="src src-bash"># Start a very useful long-running process
JOB=$(sudo docker run -d ubuntu /bin/sh -c <span style="color: #8b2252;">"while true; \</span>
<span style="color: #8b2252;">do echo Hello world; sleep 1; done"</span>)
# Collect the output of the job so far
sudo docker logs $JOB
# Kill the job
sudo docker kill $JOB
</pre>

</div>

</div>

<div id="outline-container-2-2-6" class="outline-4">
<h4 id="sec-2-2-6"><span class="section-number-4">2.2.6</span> Bind a service on a TCP port</h4>
<div class="outline-text-4" id="text-2-2-6">




<pre class="src src-bash"># Bind port 4444 of this container, and tell netcat to listen on it
JOB=$(sudo docker run -d -p 4444 ubuntu:12.10 /bin/nc -l 4444)

# Which public port is NATed to my container?
PORT=$(sudo docker port $JOB 4444 | awk -F: '{ print $2 }')

# Connect to the public port
echo hello world | nc 127.0.0.1 $PORT

# Verify that the network connection worked
echo <span style="color: #8b2252;">"Daemon received: $(sudo docker logs $JOB)"</span>
</pre>


</div>

</div>

<div id="outline-container-2-2-7" class="outline-4">
<h4 id="sec-2-2-7"><span class="section-number-4">2.2.7</span> Committing (saving) a container state</h4>
<div class="outline-text-4" id="text-2-2-7">


<p>
Save your containers state to a container image, so the state can be re-used.
</p>
<p>
When you commit your container only the differences between the image the container was created from and the current state of the container will be stored (as a diff). See which images you already have using the docker images command.
</p>


<pre class="src src-bash"># Commit your container to a new named image
sudo docker commit &lt;container_id&gt; &lt;some_name&gt;

# List your containers
sudo docker images
</pre>


</div>

</div>

<div id="outline-container-2-2-8" class="outline-4">
<h4 id="sec-2-2-8"><span class="section-number-4">2.2.8</span> Committing a Container to a Named Image</h4>
<div class="outline-text-4" id="text-2-2-8">

<p>When you make changes to an existing image, those changes get saved to a container’s file system. You can then promote that container to become an image by making a commit. In addition to converting the container to an image, this is also your opportunity to name the image, specifically a name that includes your user name from the Central Docker Index (as you did a login above) and a meaningful name for the image.
</p>


<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">format is "sudo docker commit &lt;container_id&gt; &lt;username&gt;/&lt;imagename&gt;"</span>
$ sudo docker commit $<span style="color: #a0522d;">CONTAINER_ID</span> myname/kickassapp
</pre>

</div>

</div>

<div id="outline-container-2-2-9" class="outline-4">
<h4 id="sec-2-2-9"><span class="section-number-4">2.2.9</span> Pushing an image to its repository</h4>
<div class="outline-text-4" id="text-2-2-9">

<p>In order to push an image to its repository you need to have committed your container to a named image (see above).
Now you can commit this image to the repository designated by its name or tag.
</p>


<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">format is "docker push &lt;username&gt;/&lt;repo_name&gt;"</span>
$ sudo docker push myname/kickassapp
</pre>


</div>

</div>

<div id="outline-container-2-2-10" class="outline-4">
<h4 id="sec-2-2-10"><span class="section-number-4">2.2.10</span> Private Repositories</h4>
<div class="outline-text-4" id="text-2-2-10">

<p>Right now (version 0.6), private repositories are only possible by hosting <a href="https://github.com/dotcloud/docker-registry">your private registry</a>. To push or pull to a repository on your own registry, you must prefix the tag with the address of the registry’s host, like this:
</p>


<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">Tag to create a repository with the full registry location.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">The location (e.g. localhost.localdomain:5000) becomes</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">a permanent part of the repository name</span>
sudo docker tag 0u812deadbeef localhost.localdomain:5000/repo_name
<span style="color: #b22222;"># </span><span style="color: #b22222;">Push the new repository to its home location on localhost</span>
sudo docker push localhost.localdomain:5000/repo_name
</pre>

<p>
Once a repository has your registry’s host name as part of the tag, you can push and pull it like any other repository, but it will not be searchable (or indexed at all) in the Central Index, and there will be no user name checking performed. Your registry will function completely independently from the Central Index.
</p></div>

</div>

<div id="outline-container-2-2-11" class="outline-4">
<h4 id="sec-2-2-11"><span class="section-number-4">2.2.11</span> Export a container</h4>
<div class="outline-text-4" id="text-2-2-11">

<p>To export a container to a tar file just type:
</p>


<pre class="src src-sh">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
mkl/debian          7.4                 11ed3d47ec89        About an hour ago   117.8 MB
mkl/debian          latest              11ed3d47ec89        About an hour ago   117.8 MB
mkl/debian          wheezy              11ed3d47ec89        About an hour ago   117.8 MB
ubuntu              13.10               9f676bd305a4        2 weeks ago         182.1 MB
ubuntu              saucy               9f676bd305a4        2 weeks ago         182.1 MB

$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ac3a595c294c        mkl/debian:7.4      /bin/bash           58 minutes ago      Exit 1                                  prickly_lovelace    
f7528d270208        mkl/debian:7.4      echo success        About an hour ago   Exit 0                                  jovial_pare         
6a569d77e974        ubuntu:12.04        /bin/bash           16 hours ago        Exit 0                                  backstabbing_pike 

$ docker export ac3a595c294c  &gt; exampleimage.tar
</pre>

</div>

</div>

<div id="outline-container-2-2-12" class="outline-4">
<h4 id="sec-2-2-12"><span class="section-number-4">2.2.12</span> Import a container</h4>
<div class="outline-text-4" id="text-2-2-12">

<p>At this time, the URL must start with http and point to a single file archive (.tar, .tar.gz, .tgz, .bzip, .tar.xz, or .txz) containing a root filesystem. If you would like to import from a local directory or archive, you can use the - parameter to take the data from stdin.
To import from a remote url type:
</p>


<pre class="src src-sh">$ sudo docker import http://example.com/exampleimage.tar
</pre>

<p>
To import from a local file type:
</p>


<pre class="src src-sh">$ cat exampleimage.tar | sudo docker import - exampleimagelocal:new
</pre>

<p>
Note the sudo in this example – you must preserve the ownership of the files (especially root ownership) during the archiving with tar. If you are not root (or the sudo command) when you tar, then the ownerships might not get preserved.
</p></div>

</div>

<div id="outline-container-2-2-13" class="outline-4">
<h4 id="sec-2-2-13"><span class="section-number-4">2.2.13</span> Authentication file</h4>
<div class="outline-text-4" id="text-2-2-13">


<p>
The authentication is stored in a json file, .dockercfg located in your home directory. It supports multiple registry urls.
</p>
<p>
docker login will create the “<a href="https://index.docker.io/v1/">https://index.docker.io/v1/</a>” key.
</p>
<p>
docker login <a href="https://my-registry.com">https://my-registry.com</a> will create the “<a href="https://my-registry.com">https://my-registry.com</a>” key.
</p>
<p>
For example:
</p>


<pre class="src src-JASON">{
     <span style="color: #8b2252;">"https://index.docker.io/v1/"</span>: {
             <span style="color: #8b2252;">"auth"</span>: <span style="color: #8b2252;">"xXxXxXxXxXx="</span>,
             <span style="color: #8b2252;">"email"</span>: <span style="color: #8b2252;">"email@example.com"</span>
     },
     <span style="color: #8b2252;">"https://my-registry.com"</span>: {
             <span style="color: #8b2252;">"auth"</span>: <span style="color: #8b2252;">"XxXxXxXxXxX="</span>,
             <span style="color: #8b2252;">"email"</span>: <span style="color: #8b2252;">"email@my-registry.com"</span>
     }
}
</pre>

<p>
The auth field represents base64(&lt;username&gt;:&lt;password&gt;)
</p>
</div>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Build your own base image</h3>
<div class="outline-text-3" id="text-2-3">

<p>Docker.io provides a way to create a <a href="http://docs.docker.io/en/latest/articles/baseimages/">base image</a>. The base image heavily depends on the distribution, the host is running. The example script <a href="https://github.com/dotcloud/docker/blob/master/contrib/mkimage-debootstrap.sh">mkimage-debootstrap.sh</a> creates a debian base image.
</p>
</div>

<div id="outline-container-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> Download the script</h4>
<div class="outline-text-4" id="text-2-3-1">




<pre class="src src-sh">$ wget https://raw.github.com/dotcloud/docker/master/contrib/mkimage-debootstrap.sh
$ chmod +x mkimage-debootstrap.sh
</pre>

<p>
This downloads the build-script for a debian docker base image.
</p></div>

</div>

<div id="outline-container-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> Build the base image</h4>
<div class="outline-text-4" id="text-2-3-2">




<pre class="src src-sh">$ ./mkimage-debootstrap.sh flora/debian wheezy 
$ docker images -a
</pre>

<p>
This creates a new docker base image for debain wheezy and puts it into ropsitory <i>flora/debian</i>, where <i>flora</i> is the username and <i>debian</i> the repo name.
</p></div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Installing a <i>Scala/Java</i> WebApp</h2>
<div class="outline-text-2" id="text-3">

<p>As a proof of concept, we install a <i>Scala</i> WebApp with <i>Lift</i>. We need <i>Java</i> version &gt; 6 and we use <i>Lift</i> as the framework. 
</p>
</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Installing <i>Java</i> and <i>Lift</i></h3>
<div class="outline-text-3" id="text-3-1">


</div>

<div id="outline-container-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> The necessary debian packages</h4>
<div class="outline-text-4" id="text-3-1-1">

<p>We need <i>jdk</i> at least version 6, <i>wegt</i> and <i>zip</i>:
</p>


<pre class="src src-sh">$ apt-get install -y openjdk-7-jre
$ apt-get install -y openjdk-7-jdk
$ apt-get install -y wget
$ apt-get install -y zip
</pre>

<p>
This installs Java 7 and my take a minute.
</p></div>

</div>

<div id="outline-container-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> <span class="todo TODO">TODO</span> check if we need apache packages?</h4>
<div class="outline-text-4" id="text-3-1-2">

</div>

</div>

<div id="outline-container-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Scala WebApp</h4>
<div class="outline-text-4" id="text-3-1-3">

<p>We download and configure a sample <i>Scala</i> WebApp and generate the War-file.
</p>


<pre class="src src-sh">$ cd /opt
$ wget https://github.com/Lift/Lift_26_sbt/archive/master.zip
$ unzip master.zip
$ cd lift_26_sbt-master/scala_210/lift_basic/
$ ./sbt  compile
$ ./sbt  package
</pre>

<p>
<a href="http:///Lift/web.net/getting_started"><i>Lift</i> web framework</a>  will download <i>sbt</i>, <i>Scala</i> and the necessary dependencies and compile the War-File <b>/opt/lift_26_sbt-master/scala_210/lift_basic/target/scala-2.10/lift-2.6-starter-template<sub>2</sub>.10-0.0.3.war</b>. By typing
</p>


<pre class="src src-sh">$ ./sbt 
&gt; start
</pre>

<p>
we should be able to see the WebApp at <a href="http://localhost:8080">http://localhost:8080</a>. To exit just type <code>exit</code>. The source of this WebApp is under <b>/opt/lift_26_sbt-master/scala_210/lift_basic/src/main/webapp/</b>. To prove the concept, we will later just change <i>index.html</i>.
</p></div>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Installing <i>tomcat7</i></h3>
<div class="outline-text-3" id="text-3-2">

<p>We use <i>tomcat</i> as the <b>Apache Tomcat Servlet/JSP</b> engine to serve our <i>Scala</i> WebApp, installing it by typing:
</p>


<pre class="src src-sh">$ apt-get install tomcat7 
</pre>

<p>
Tomcat serves servlets  at <a href="http://localhost:8080">http://localhost:8080</a>. The debian package starts the service automatically at boot time via <i>etc/init.d/tomcat7</i> script.
</p></div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Deploying the WebApp to <i>tomcat7</i></h3>
<div class="outline-text-3" id="text-3-3">

<p><i>Lift</i> uses <i>sbt</i> to compile the project and output a WAR- or JAR-file, which we want to copy into <i>tomcat7</i>'s webapp directory <b>/var/lib/tomcat7/webapps/</b>. We recompile the package and deploy it statically into <i>tomcat</i>.
</p>


<pre class="src src-sh">$ cd /opt/lift_26_sbt-master/scala_210/lift_basic/
$  ./sbt  package
$ cp  target/scala-2.10/lift-2.6-starter-template_2.10-0.0.3.war <span style="color: #8b2252;">\</span>
    /var/lib/tomcat7/webapps/lift.war
$ service tomcat7 restart
</pre>

<p>
This copies the war-file and restarts <i>tomcat7</i>. To see the WebApp direct your browser to <a href="http://localhost:8080/lift_basic/">http://localhost:8080/lift<sub>basic</sub>/</a>. There is no need to restart <i>tomcat</i> manually, as the <i>autoDeploy</i> attribute is set to "true" in file <b>/etc/tomcat7/server.xml</b>. <i>tomcat</i> even unpacks war-files if attribute <i>unpackWARs</i> is set to "true".
</p></div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Installing Jenkinsx</h2>
<div class="outline-text-2" id="text-4">

<p>How to install a jenkins server
</p></div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Configure Jenkins to publish a container into the registry</h2>
<div class="outline-text-2" id="text-5">


<p>
Each time the WebApp has changed in git, Jenkins builds a new container,  consisting of three parts:
</p><ol>
<li>Deploying the WebApp-Files into the latest container.
</li>
<li>Commit the newly build container and tag it properly.
</li>
<li>Start the newly taged container.
</li>
</ol>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-02-19 18:26:26 CET</p>
<p class="author">Author: Michael Klöckner</p>
<p class="creator">Org version 7.8.11 with Emacs version 23</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
